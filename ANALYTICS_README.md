# 📊 网站统计分析系统

## 🎯 概述

本项目集成了完整的本地统计分析系统，支持 IP 地址访问，无需域名配置。

## ✨ 功能特性

- **🌐 无需域名**：支持 IP 地址访问
- **📊 实时统计**：自动收集页面访问数据
- **📈 丰富图表**：访问趋势、设备分布、页面排行
- **🔒 隐私友好**：本地存储，数据完全可控
- **⚡ 轻量级**：无需数据库，JSON 文件存储
- **📱 响应式**：支持移动端和桌面端

## 🚀 快速开始

### 方法 1：一键启动（推荐）
```bash
./start-analytics.sh
```

### 方法 2：手动启动
```bash
# 终端1：启动统计分析服务器
node analytics-server.js

# 终端2：启动前端开发服务器
npm run dev
```

## 📁 文件结构

```
src/
├── utils/
│   └── localAnalytics.ts       # 统计工具模块
├── pages/
│   └── Analytics/
│       ├── index.tsx           # 统计仪表板页面
│       └── Analytics.module.css # 页面样式
├── components/
│   └── Header/
│       └── index.tsx           # 添加了统计菜单
└── App.tsx                     # 集成了自动统计
```

## 🔧 配置说明

### 环境变量（可选）
```bash
# .env.local - Google Analytics 配置（已禁用）
VITE_GA_TRACKING_ID=G-XXXXXXXXXX
```

### 依赖要求
- **Node.js** ≥ 14.0（统计分析服务器）
- **npm** 包管理
- **Express** Web 框架
- **CORS** 跨域支持

## 📊 API 接口

### 1. 健康检查
```http
GET /api/analytics/health
```

### 2. 获取统计数据
```http
GET /api/analytics
```

**响应数据：**
```json
{
  "totalVisits": 1234,
  "todayVisits": 45,
  "weeklyVisits": 234,
  "monthlyVisits": 567,
  "lastVisit": "2024-01-15T10:30:00.000Z",
  "visits": [...],
  "pages": { "/": 120, "/about": 23 },
  "dailyStats": { "2024-01-15": 45, "2024-01-14": 32 },
  "devices": { "desktop": 89, "mobile": 23, "tablet": 11 }
}
```

### 3. 获取统计摘要
```http
GET /api/analytics/summary
```

### 4. 记录访问
```http
POST /api/analytics/track
Content-Type: application/json

{
  "id": "visit-id",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "page": "/",
  "userAgent": "Mozilla/5.0...",
  "referrer": "https://google.com",
  "device": "desktop",
  "browser": "chrome",
  "ip": "192.168.1.100",
  "country": "China",
  "city": "Beijing"
}
```

### 5. 重置数据
```http
DELETE /api/analytics/reset
```

## 📈 统计指标

### 访问量统计
- **总访问量**：历史总访问次数
- **今日访问**：当天的访问次数
- **本周访问**：最近7天的访问次数
- **本月访问**：最近30天的访问次数

### 页面分析
- **页面访问排行**：各页面访问次数排序
- **最近访问记录**：最近10条访问记录

### 设备分析
- **桌面端**：传统电脑访问统计
- **移动端**：手机访问统计
- **平板端**：平板访问统计

### 趋势分析
- **访问趋势图**：最近7天的访问变化
- **时间分布**：访问时间热点分析

## 🎨 统计仪表板

访问地址：`http://localhost:3000/analytics`

### 主要功能区域

1. **📊 统计概览**
   - 总访问量卡片
   - 今日访问量卡片
   - 本周/本月访问量

2. **📈 趋势分析**
   - 7天访问趋势折线图
   - 访问量变化趋势

3. **🥧 设备分布**
   - 设备类型饼图
   - 桌面/移动/平板占比

4. **📄 页面排行**
   - 页面访问量柱状图
   - TOP 5 热门页面

5. **📋 访问记录**
   - 最近10条访问记录
   - 包含时间、页面、设备、浏览器、来源

6. **🔧 管理功能**
   - 手动刷新数据
   - 重置所有统计数据

## 🔄 自动统计

系统会自动收集以下统计数据：

- ✅ **页面浏览**：用户访问每个页面时自动记录
- ✅ **设备信息**：自动检测用户设备类型和浏览器
- ✅ **访问时间**：记录准确的访问时间戳
- ✅ **来源信息**：记录用户来源页面
- ✅ **实时更新**：数据实时更新无需刷新

## 🛠️ 故障排除

### 统计服务器无法启动
```bash
# 检查 Node.js
node --version

# 检查端口占用
netstat -tlnp | grep :3001

# 检查依赖
npm list express cors
```

### 前端无法连接统计
- 确认分析服务器运行在端口 3001
- 检查 CORS 设置
- 查看浏览器控制台错误信息

### 数据不显示
- 检查 `analytics-data.json` 文件权限
- 确认前端正确请求 API
- 查看网络请求状态

## 🔒 安全考虑

- **数据隔离**：统计数据存储在本地，不会外泄
- **访问控制**：通过 Nginx 配置访问控制
- **日志记录**：可添加访问日志记录
- **数据备份**：定期备份 `analytics-data.json`

## 📱 部署说明

### 生产环境部署
```bash
# 1. 构建应用
./deploy.sh

# 2. 配置 Nginx
# 参考 nginx.conf 配置文件

# 3. 启动分析服务器
nohup node analytics-server.js &

# 4. 配置代理
# Nginx 代理 /api/analytics 到 localhost:3001
```

### 数据持久化
- 数据保存在 `analytics-data.json` 文件
- 建议定期备份此文件
- 文件位置：项目根目录

## 🎯 使用场景

### 1. 内部网站监控
- 企业内部网站访问统计
- 无需外网域名的内网环境
- 完全自主控制的数据收集

### 2. 开发测试环境
- 前端开发时的访问统计
- A/B 测试效果分析
- 用户体验优化数据

### 3. 临时活动页面
- 短期活动页面统计
- 营销活动效果分析
- 用户行为路径分析

## 📞 性能优化

- **增量更新**：只发送变化的统计数据
- **缓存策略**：前端合理缓存统计数据
- **压缩存储**：JSON 数据文件压缩
- **懒加载**：图表按需加载

## 🔄 版本更新

系统会持续改进，新功能包括：
- [ ] 地理位置分析
- [ ] 用户行为漏斗
- [ ] 热力图分析
- [ ] 导出报告功能
- [ ] 自定义时间范围
- [ ] 多维度数据分析

## 📞 技术支持

如遇到问题，请检查：
1. **日志输出**：查看控制台错误信息
2. **网络请求**：使用开发者工具检查 API 请求
3. **文件权限**：确保 `analytics-data.json` 可写
4. **端口占用**：确认端口 3001 和 3000 可用
5. **依赖版本**：更新到最新版本的依赖包

---

**🎉 享受数据驱动的网站运营体验！**